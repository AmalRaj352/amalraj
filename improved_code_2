<!DOCTYPE html>
<html>
<head>
    <title>Task 1A TKM Location Mapper</title>

    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>

    <style>
        body {
            font-family: Arial;
            margin: 20px;
        }

        input {
            width: 180px;
            margin: 8px;
            padding: 8px;
        }

        button {
            padding: 10px 30px;
            background: #007cba;
            color: white;
            border: none;
            cursor: pointer;
        }

        #map {
            height: 320px;
            width: 90%;
            margin-top: 20px;
            border: 3px solid #ccc;
        }

        #placeBox {
            width: 90%;
            margin-top: 10px;
            padding: 10px;
            border: 1px solid #333;
            background: #f2f2f2;
            font-size: 15px;
        }
    </style>
</head>

<body>

<center><h1>Find Latitude and Longitude</h1></center>

Latitude :
<input type="number" id="lat" placeholder="Latitude (eg: 11.5647)" step="any"><br>

Longitude :
<input type="number" id="lng" placeholder="Longitude (eg: 75.6508)" step="any"><br>

<center>
    <button onclick="updateMap()">Show Location</button>
</center>

<center>
    <h3>Your Location</h3>
    <div id="placeBox">Location name will appear here</div>
</center>

<center>
    <div id="map"></div>
</center>

<!-- Leaflet JS -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
    /* ================= MAP LAYERS ================= */

    const normalMap = L.tileLayer(
        'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',
        { attribution: '&copy; OpenStreetMap contributors' }
    );

    const satelliteMap = L.tileLayer(
        'https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}',
        { attribution: '&copy; Esri & contributors' }
    );

    /* ================= MAP INIT ================= */

    const map = L.map('map', {
        center: [13.0827, 80.2707],
        zoom: 3,
        layers: [normalMap]
    });

    L.control.layers(
        {
            "Normal View": normalMap,
            "Satellite View": satelliteMap
        }
    ).addTo(map);

    /* ================= MARKER ================= */

    let lat = 11.564;
    let lng = 75.6;

    let marker = L.marker([lat, lng]).addTo(map);

    const placeBox = document.getElementById("placeBox");

    /* ================= EARTH ROTATION ================= */

    let rotation = setInterval(() => {
        lng += 0.1;
        if (lng > 180) lng = -180;
        map.setView([lat, lng], map.getZoom(), { animate: true });
    }, 100);

    /* ================= UPDATE MAP ================= */

    function updateMap() {

        const inputLat = parseFloat(document.getElementById("lat").value);
        const inputLng = parseFloat(document.getElementById("lng").value);

        if (isNaN(inputLat) || isNaN(inputLng)) {
            alert("Please enter valid Latitude and Longitude");
            return;
        }

        clearInterval(rotation);

        lat = inputLat;
        lng = inputLng;

        marker.setLatLng([lat, lng]);
        map.setView([lat, lng], 10);

        fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lng}`)
            .then(res => res.json())
            .then(data => {
                if (data.display_name) {
                    placeBox.innerHTML = "<b>Location:</b> " + data.display_name;
                    marker.bindPopup("<b>" + data.display_name + "</b>").openPopup();
                } else {
                    placeBox.innerHTML = "Location name not found";
                }
            })
            .catch(() => {
                placeBox.innerHTML = "Error fetching location name";
            });
    }
</script>

</body>
</html>
